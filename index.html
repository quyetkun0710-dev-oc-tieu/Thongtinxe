<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>QU·∫¢N L√ù PH∆Ø∆†NG TI·ªÜN</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">

<style>
body { background:#f4f6f8 }
.hidden { display:none }
.card-hover { transition:0.2s }
.card-hover:hover { cursor:pointer; transform:scale(1.03) }
.form-box { max-width:1100px; margin:auto }

/* ===== HEADER TRANG ƒê·∫¶U (HOME ONLY) ===== */

.home-header {
  background: linear-gradient(135deg, #fc1818, #b63c3c);
  border-radius: 16px;
  padding: 28px 32px;
  margin-bottom: 32px;
  color: #ffffff;
  display: flex;
  align-items: center;
  gap: 20px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.18);
}

.home-header .logo {
  width: 72px;
  height: 72px;
  border-radius: 50%;
  background: rgba(161, 245, 169, 0.18);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
}

.home-header .title-box h1 {
  margin: 0;
  font-size: 26px;
  font-weight: 800;
  letter-spacing: 0.5px;
}

.home-header .title-box p {
  margin-top: 6px;
  font-size: 14px;
  opacity: 0.9;
}

/* mobile */
@media (max-width: 768px) {
  .home-header {
    flex-direction: column;
    text-align: center;
  }
}
</style>
</head>

<body>

<section class="section">
<div class="container">

<!-- ================= HOME ================= -->
<div id="home">
<div class="home-header">
<div class="header-inner header-center">
  <img src="https://drive.google.com/thumbnail?id=12ye0HEGRTrKu57KVf05AV04ZdmMtN541&sz=w800">
</div>
 <div class="title-box">
    <h1>MANAGERMENT FLEET SYSTEM</h1>
    <p></p>
  </div>
</div>


<div class="columns is-multiline">
  <div class="column is-3">
    <div class="card card-hover" onclick="openTag('xe')">
      <div class="card-content has-text-centered">
        <p class="title is-5">üöö Th√¥ng tin xe</p>
      </div>
    </div>
  </div>

  <div class="column is-3">
    <div class="card card-hover" onclick="openTag('taixe')">
      <div class="card-content has-text-centered">
        <p class="title is-5">üë®‚Äç‚úàÔ∏è T√†i x·∫ø</p>
      </div>
    </div>
  </div>

  <div class="column is-3">
    <div class="card card-hover" onclick="openTag('nhatky')">
      <div class="card-content has-text-centered">
        <p class="title is-5">üìí Nh·∫≠t k√Ω v·∫≠n h√†nh</p>
      </div>
    </div>
  </div>

  <div class="column is-3">
    <div class="card card-hover" onclick="openTag('baoduong')">
      <div class="card-content has-text-centered">
        <p class="title is-5">üõ†Ô∏è B·∫£o d∆∞·ª°ng</p>
      </div>
    </div>
  </div>

  <div class="column is-3">
  <div class="card card-hover" onclick="openTag('fuel')">
    <div class="card-content has-text-centered">
      <p class="title is-5">‚õΩ Nhi√™n li·ªáu</p>
    </div>
  </div>
</div>
</div>
<div class="column is-3">
  <div class="card card-hover" onclick="openTag('danhgia')">
    <div class="card-content has-text-centered">
      <p class="title is-5">üìä ƒê√°nh gi√° nh√¢n s·ª±</p>
    </div>
  </div>
</div>
</div>

<!-- ================= START TAG: TH√îNG TIN XE ================= -->
<div id="xe" class="hidden form-box">

<button class="button mb-4" onclick="backHome()">‚¨Ö Quay l·∫°i</button>
<h2 class="title is-4 has-text-weight-bold">üöö TH√îNG TIN XE</h2>

<!-- ========= TRA C·ª®U ========= -->
<section class="box">
<h3 class="subtitle has-text-info">üîç Tra c·ª©u BI·ªÇN S·ªê XE</h3>
<div class="columns is-vcentered">
  <div class="column is-4">
    <label class="label">Bi·ªÉn s·ªë xe (KEY)</label>
    <input class="input" id="search_bien_so_xe" placeholder="VD: 51C-12345">
  </div>
  <div class="column">
    <button class="button is-info mt-5" type="button" onclick="searchXe()">Tra c·ª©u</button>
  </div>
</div>
<div id="xe_result" class="mt-4"></div>
</section>

<form id="xeForm">

<!-- ========= 1. TH√îNG TIN C∆† B·∫¢N ========= -->
<h3 class="subtitle">1Ô∏è‚É£ Th√¥ng tin c∆° b·∫£n</h3>
<div class="columns">
  <div class="column">
    <label class="label">Bi·ªÉn s·ªë xe</label>
    <input class="input" name="bien_so_xe">
  </div>
  <div class="column">
    <label class="label">Lo·∫°i xe</label>
    <input class="input" name="loai_xe">
  </div>
  <div class="column">
    <label class="label">T·∫£i tr·ªçng</label>
    <input class="input" name="tai_trong">
  </div>
</div>

<!-- ========= 2. TH√îNG S·ªê K·ª∏ THU·∫¨T ========= -->
<h3 class="subtitle">2Ô∏è‚É£ Th√¥ng s·ªë k·ªπ thu·∫≠t</h3>
<div class="columns">
  <div class="column">
    <label class="label">NƒÉm s·∫£n xu·∫•t</label>
    <input class="input" name="nam_sx">
  </div>
  <div class="column">
    <label class="label">S·ªë khung</label>
    <input class="input" name="so_khung">
  </div>
  <div class="column">
    <label class="label">S·ªë m√°y</label>
    <input class="input" name="so_may">
  </div>
</div>

<div class="columns">
  <div class="column">
    <label class="label">M√£ lo·∫°i</label>
    <input class="input" name="ma_loai">
  </div>
  <div class="column"></div>
  <div class="column"></div>
</div>

<!-- ========= 3. K√çCH TH∆Ø·ªöC & TH·ªÇ T√çCH ========= -->
<h3 class="subtitle">3Ô∏è‚É£ K√≠ch th∆∞·ªõc th√πng</h3>
<div class="columns">
  <div class="column">
    <label class="label">D√†i (m)</label>
    <input class="input" type="number" step="0.01" name="thung_dai" oninput="calcTheTichThung()">
  </div>
  <div class="column">
    <label class="label">R·ªông (m)</label>
    <input class="input" type="number" step="0.01" name="thung_rong" oninput="calcTheTichThung()">
  </div>
  <div class="column">
    <label class="label">Cao (m)</label>
    <input class="input" type="number" step="0.01" name="thung_cao" oninput="calcTheTichThung()">
  </div>
</div>

<div class="columns">
  <div class="column">
    <label class="label">K√≠ch th∆∞·ªõc th√πng</label>
    <input class="input" name="kich_thuoc_thung" readonly>
  </div>
  <div class="column">
    <label class="label">Th·ªÉ t√≠ch th√πng (m¬≥)</label>
    <input class="input" name="the_tich_thung" readonly>
  </div>
  <div class="column"></div>
</div>

<!-- ========= 4. KH·ªêI L∆Ø·ª¢NG ========= -->
<h3 class="subtitle">4Ô∏è‚É£ Kh·ªëi l∆∞·ª£ng</h3>
<div class="columns">
  <div class="column">
    <label class="label">Kh·ªëi l∆∞·ª£ng b·∫£n th√¢n</label>
    <input class="input" name="khoi_luong_ban_than">
  </div>
  <div class="column">
    <label class="label">Kh·ªëi l∆∞·ª£ng chuy√™n ch·ªü</label>
    <input class="input" name="khoi_luong_cho_phep">
  </div>
  <div class="column"></div>
</div>

<!-- ========= 5. PH√ÅP L√ù ========= -->
<h3 class="subtitle">5Ô∏è‚É£ Th√¥ng tin ph√°p l√Ω</h3>

<div class="columns">
  <div class="column">
    <label class="label">S·ªë ƒëƒÉng k√Ω</label>
    <input class="input" name="so_dang_ky">
  </div>
  <div class="column">
    <label class="label">Ng√†y ƒëƒÉng k√Ω</label>
    <input class="input" type="date" name="ngay_dang_ky" onchange="calc(this,30,'cb_dk')">
  </div>
  <div class="column"></div>
</div>

<div class="columns">
  <div class="column">
    <label class="label">S·ªë ƒëƒÉng ki·ªÉm</label>
    <input class="input" name="so_dang_kiem">
  </div>
  <div class="column">
    <label class="label">Ng√†y ƒëƒÉng ki·ªÉm</label>
    <input class="input" type="date" name="ngay_dang_kiem" onchange="calc(this,30,'cb_dkiem')">
  </div>
  <div class="column"></div>
</div>

<div class="columns">
  <div class="column">
    <label class="label">S·ªë ph√π hi·ªáu</label>
    <input class="input" name="so_phu_hieu">
  </div>
  <div class="column">
    <label class="label">Ng√†y ph√π hi·ªáu</label>
    <input class="input" type="date" name="ngay_phu_hieu" onchange="calc(this,15,'cb_ph')">
  </div>
  <div class="column"></div>
</div>

<div class="columns">
  <div class="column">
    <label class="label">S·ªë b·∫£o hi·ªÉm</label>
    <input class="input" name="so_bao_hiem">
  </div>
  <div class="column">
    <label class="label">Ng√†y b·∫£o hi·ªÉm</label>
    <input class="input" type="date" name="ngay_bao_hiem" onchange="calc(this,30,'cb_bh')">
  </div>
  <div class="column"></div>
</div>

<!-- ========= 6. TR·∫†NG TH√ÅI ========= -->
<h3 class="subtitle">6Ô∏è‚É£ Tr·∫°ng th√°i</h3>
<div class="columns">
  <div class="column">
    <label class="label">T√¨nh tr·∫°ng ho·∫°t ƒë·ªông</label>
    <label class="radio"><input type="radio" name="tinh_trang_hoat_dong" value="dang_hoat_dong" checked> üü¢ ƒêang ho·∫°t ƒë·ªông</label><br>
    <label class="radio"><input type="radio" name="tinh_trang_hoat_dong" value="da_ngung"> üî¥ ƒê√£ ng·ª´ng</label><br>
    <label class="radio"><input type="radio" name="tinh_trang_hoat_dong" value="da_ban_giao"> üü° ƒê√£ b√†n giao</label>
  </div>

  <div class="column">
    <label class="label">Lo·∫°i bi·ªÉn s·ªë</label>
    <label class="radio"><input type="radio" name="loai_bien_so" value="bien_vang" checked> Bi·ªÉn v√†ng</label><br>
    <label class="radio"><input type="radio" name="loai_bien_so" value="bien_trang"> Bi·ªÉn tr·∫Øng</label>
  </div>
  <div class="column"></div>
</div>

<!-- ========= HIDDEN ========= -->
<input type="hidden" name="cb_dk">
<input type="hidden" name="cb_dkiem">
<input type="hidden" name="cb_ph">
<input type="hidden" name="cb_bh">
<input type="hidden" name="created_at">
<input type="hidden" name="updated_at">


<button class="button is-primary is-fullwidth mt-5">
üíæ L∆ØU TH√îNG TIN XE
</button>

</form>
</div>
<!-- ================= END TAG: TH√îNG TIN XE ================= -->



<!-- ================= START TAG: TH√îNG TIN T√ÄI X·∫æ ================= -->
<div id="taixe" class="hidden form-box">

<button class="button mb-4" onclick="backHome()">‚¨Ö Quay l·∫°i</button>
<h2 class="title is-4">üë®‚Äç‚úàÔ∏è TH√îNG TIN T√ÄI X·∫æ</h2>

<!-- ===== TRA C·ª®U ===== -->
<section class="box">
  <h3 class="subtitle">üîç Tra c·ª©u M√É NH√ÇN VI√äN</h3>
  <div class="columns">
    <div class="column is-4">
      <input class="input" id="search_mnv" placeholder="Nh·∫≠p m√£ nh√¢n vi√™n">
    </div>
    <div class="column">
      <button class="button is-info" onclick="searchTaiXe()">Tra c·ª©u</button>
    </div>
  </div>
</section>

<form id="taixeForm">

<!-- 1. TH√îNG TIN C√Å NH√ÇN -->
<h3 class="subtitle">1Ô∏è‚É£ Th√¥ng tin c√° nh√¢n</h3>
<div class="columns">
  <div class="column"><input class="input" name="ho_ten" placeholder="H·ªç v√† t√™n"></div>
  <div class="column"><input class="input" name="ma_nv" placeholder="M√£ nh√¢n vi√™n"></div>
  <div class="column"><input class="input" name="nam_sinh" placeholder="NƒÉm sinh"></div>
</div>

<div class="columns">
  <div class="column"><input class="input" name="gioi_tinh" placeholder="Gi·ªõi t√≠nh"></div>
  <div class="column"><input class="input" name="cccd" placeholder="CCCD / H·ªô chi·∫øu"></div>
  <div class="column"><input class="input" name="sdt" placeholder="S·ªë ƒëi·ªán tho·∫°i"></div>
</div>

<div class="columns">
  <div class="column"><input class="input" name="que_quan" placeholder="Qu√™ qu√°n"></div>
</div>

<!-- 2. GPLX -->
<h3 class="subtitle">2Ô∏è‚É£ Gi·∫•y ph√©p l√°i xe</h3>
<div class="columns">
  <div class="column"><input class="input" name="hang_gplx" placeholder="H·∫°ng GPLX"></div>
  <div class="column"><input class="input" name="so_gplx" placeholder="S·ªë GPLX"></div>
</div>

<div class="columns">
  <div class="column"><input type="date" class="input" name="ngay_trung_tuyen"></div>
  <div class="column"><input class="input" name="noi_cap"></div>
  <div class="column"><input type="date" class="input" name="han_gplx"></div>
</div>

<!-- 3. QU√Å TR√åNH L√ÄM VI·ªÜC -->
<h3 class="subtitle">3Ô∏è‚É£ Qu√° tr√¨nh l√†m vi·ªác</h3>
<div class="columns">
  <div class="column">
    <input type="date" class="input" name="ngay_nhan_viec" onchange="calcChinhThuc()">
  </div>
<div class="column">
  <div class="field">
  <label class="label">Th·ª≠ vi·ªác</label>
  <div class="control">
    <div class="select is-fullwidth">
      <select name="thu_viec" onchange="calcChinhThuc()" required>
        <option value="">-- Ch·ªçn th·ªùi gian --</option>
        <option value="1">1 th√°ng</option>
        <option value="2">2 th√°ng</option>
        <option value="3">Gia h·∫°n th√™m</option>
      </select>
    </div>
  </div>
</div>


  <div class="column">
    <input class="input" name="chinh_thuc" placeholder="Ng√†y ch√≠nh th·ª©c" readonly>
  </div>
</div>

<div class="columns">
  <div class="column"><input class="input" name="ghi_chu"></div>
</div>

<!-- 4. PH√ÇN C√îNG -->
<h3 class="subtitle">4Ô∏è‚É£ Ph√¢n c√¥ng</h3>
<div class="columns">
  <div class="column"><input class="input" name="xe_phu_trach"></div>
  <div class="column"><input class="input" name="tuyen_phu_trach"></div>
</div>

<!-- 5. B·∫¢O L√ÉNH -->
<h3 class="subtitle">5Ô∏è‚É£ B·∫£o l√£nh</h3>
<div class="columns">
  <div class="column"><input class="input" name="bl_ho_ten"></div>
  <div class="column"><input class="input" name="bl_quan_he"></div>
  <div class="column"><input class="input" name="bl_sdt"></div>
</div>

<div class="columns">
  <div class="column"><input class="input" name="bl_que_quan"></div>
</div>

<!-- 6. H·ªí S∆† -->
<h3 class="subtitle">6Ô∏è‚É£ H·ªì s∆°</h3>
<label><input type="checkbox" name="hs_cccd"> CCCD</label>
<label><input type="checkbox" name="hs_gplx"> GPLX</label>
<label><input type="checkbox" name="hs_suc_khoe"> Gi·∫•y kh√°m s·ª©c kho·∫ª</label>
<label><input type="checkbox" name="hs_so_yeu"> S∆° y·∫øu l√Ω l·ªãch</label>
<label><input type="checkbox" name="hs_cu_tru"> X√°c nh·∫≠n c∆∞ tr√∫</label>
<label><input type="checkbox" name="hs_dan_su"> X√°c nh·∫≠n d√¢n s·ª±</label>

<button class="button is-primary is-fullwidth mt-4" type="submit">
üíæ L∆ØU TH√îNG TIN T√ÄI X·∫æ
</button>
</form>
</div>
 </section>
<!-- ================= TAG: NH·∫¨T K√ù V·∫¨N H√ÄNH ================= -->
<div id="nhatky" class="hidden form-box">

<button class="button mb-4" type="button" onclick="backHome()">‚¨Ö Quay l·∫°i</button>
<h2 class="title is-4">üìí NH·∫¨T K√ù V·∫¨N H√ÄNH</h2>

<!-- TRA C·ª®U -->
<div class="box">
  <h3 class="subtitle">üîç Tra c·ª©u NK ID</h3>
  <div class="columns is-vcentered">
    <div class="column is-4">
      <input class="input" id="search_nk_id" placeholder="VD: NK001">
    </div>
    <div class="column">
      <button class="button is-info" type="button" onclick="searchNhatKy()">Tra c·ª©u</button>
    </div>
  </div>
</div>

<form id="nhatkyForm">

<div class="columns">
  <div class="column">
    <label class="label">NK ID</label>
    <input class="input" name="nk_id">
  </div>
  <div class="column">
    <label class="label">Bi·ªÉn s·ªë xe</label>
    <input class="input" name="nk_bien_so_xe">
  </div>
  <div class="column">
    <label class="label">T√†i x·∫ø</label>
    <input class="input" name="nk_tai_xe">
  </div>
</div>

<div class="columns">
  <div class="column">
    <label class="label">Gi·ªù xu·∫•t</label>
    <input class="input" type="time" name="nk_gio_xuat" oninput="calcNhatKy()">
  </div>
  <div class="column">
    <label class="label">Gi·ªù v·ªÅ</label>
    <input class="input" type="time" name="nk_gio_ve" oninput="calcNhatKy()">
  </div>
  <div class="column">
    <label class="label">T·ªïng gi·ªù</label>
    <input class="input" name="nk_tong_gio" readonly>
  </div>
</div>

<div class="columns">
  <div class="column">
    <label class="label">KM xu·∫•t</label>
    <input class="input" name="nk_km_xuat" oninput="calcNhatKy()">
  </div>
  <div class="column">
    <label class="label">KM v·ªÅ</label>
    <input class="input" name="nk_km_ve" oninput="calcNhatKy()">
  </div>
  <div class="column">
    <label class="label">T·ªïng KM</label>
    <input class="input" name="nk_tong_km" readonly>
  </div>
</div>

<div class="field">
  <label class="label">Ghi ch√∫</label>
  <textarea class="textarea" name="nk_ghi_chu"></textarea>
</div>

<button class="button is-primary mt-4" type="submit">
üíæ L∆∞u nh·∫≠t k√Ω
</button>

</form>
</div>
<!-- ================= END TAG: NH·∫¨T K√ù ================= -->


<!-- ================= TAG: B·∫¢O D∆Ø·ª†NG ================= -->
<div id="baoduong" class="hidden form-box">

<button class="button mb-4" type="button" onclick="backHome()">‚¨Ö Quay l·∫°i</button>
<h2 class="title is-4">üõ†Ô∏è B·∫¢O D∆Ø·ª†NG ‚Äì S·ª¨A CH·ªÆA</h2>

<!-- TRA C·ª®U -->
<div class="box">
  <h3 class="subtitle">üîç Tra c·ª©u BD ID</h3>
  <div class="columns is-vcentered">
    <div class="column is-4">
      <input class="input" id="search_bd_id" placeholder="VD: BD001">
    </div>
    <div class="column">
      <button class="button is-info" type="button" onclick="searchbaoduong()">Tra c·ª©u</button>
    </div>
  </div>
</div>

<form id="baoduongForm">

<div class="columns">
  <div class="column">
    <label class="label">BD ID</label>
    <input class="input" name="bd_id">
  </div>
  <div class="column">
    <label class="label">Bi·ªÉn s·ªë xe</label>
    <input class="input" name="bd_bien_so_xe">
  </div>
  <div class="column">
    <label class="label">KM</label>
    <input class="input" name="bd_km">
  </div>
</div>

<div class="columns">
  <div class="column">
    <label class="label">H·∫°ng m·ª•c</label>
    <input class="input" name="bd_hang_muc">
  </div>
  <div class="column">
    <label class="label">ƒê∆°n v·ªã s·ª≠a</label>
    <input class="input" name="bd_don_vi">
  </div>
  <div class="column">
    <label class="label">T·ªïng ti·ªÅn</label>
    <input class="input" name="bd_tong_tien">
  </div>
</div>

<div class="field">
  <label class="label">Ghi ch√∫</label>
  <textarea class="textarea" name="bd_ghi_chu"></textarea>
</div>

<button class="button is-primary mt-4" type="submit">
üíæ L∆∞u b·∫£o d∆∞·ª°ng
</button>

</form>
</div>
<!-- ================= END TAG: B·∫¢O D∆Ø·ª†NG ================= -->

<!-- ================= TAG QU·∫¢N L√ù NHI√äN LI·ªÜU ================= -->
<div id="fuel" class="hidden form-box">
<button class="button mb-4" onclick="backHome()">‚¨Ö Quay l·∫°i</button>
<h2 class="title is-4">NHI√äN LI·ªÜU</h2>

<!-- TRA C·ª®U -->
<div class="box">
  <h3 class="subtitle">üîç Tra c·ª©u theo NL ID</h3>
  <div class="columns">
    <div class="column is-4">
      <input class="input" id="search_nl_id" placeholder="VD: NL001">
    </div>
    <div class="column">
      <button class="button is-info" onclick="searchfuel()">Tra c·ª©u</button>
    </div>
  </div>
</div>

<form id="fuelForm">

<h3 class="subtitle">1. Th√¥ng tin ch√≠nh</h3>
<div class="columns">
  <div class="column">
    <label class="label">NL ID</label>
    <input class="input" name="nl_id" required>

  </div>
  <div class="column">
    <label class="label">Bi·ªÉn s·ªë xe</label>
    <input class="input" name="nl_bien_so_xe">
  </div>
  <div class="column">
    <label class="label">KM khi b·ªï sung</label>
    <input class="input" name="nl_km">
  </div>
</div>

<h3 class="subtitle">2. Chi ti·∫øt nhi√™n li·ªáu</h3>
<div class="columns">

  <div class="column">
    <div class="field">
      <label class="label">Lo·∫°i nhi√™n li·ªáu</label>
      <div class="control">
        <div class="select is-fullwidth">
          <select name="nl_loai" required>
            <option value="">-- Ch·ªçn lo·∫°i --</option>
            <option value="dau">D·∫ßu</option>
            <option value="xang">XƒÉng</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="column">
    <label class="label">S·ªë l√≠t</label>
    <input class="input" type="number" name="nl_so_lit" oninput="tinhTienNhienLieu()">
  </div>

  <div class="column">
    <label class="label">ƒê∆°n gi√°</label>
    <input class="input" type="number" name="nl_don_gia" oninput="tinhTienNhienLieu()">
  </div>

  <div class="column">
    <label class="label">Th√†nh ti·ªÅn</label>
    <input class="input" name="nl_thanh_tien" readonly>
  </div>

</div>

<h3 class="subtitle">3. Thanh to√°n</h3>
<div class="columns">

  <div class="column">
    <div class="field">
      <label class="label">H√¨nh th·ª©c thanh to√°n</label>
      <div class="control">
        <div class="select is-fullwidth">
          <select name="nl_thanh_toan">
            <option value="">-- Ch·ªçn --</option>
            <option value="cong_no">C√¥ng n·ª£</option>
            <option value="tien_mat">Thanh to√°n ngay</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="column">
    <div class="field">
      <label class="label">H√≥a ƒë∆°n</label>
      <div class="control">
        <div class="select is-fullwidth">
          <select name="nl_hoa_don">
            <option value="">-- Ch·ªçn --</option>
            <option value="co">C√≥</option>
            <option value="khong">Kh√¥ng</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="column">
    <label class="label">Ng√†y th·ª±c hi·ªán</label>
    <input class="input" type="date" name="nl_ngay">
  </div>

</div>

<h3 class="subtitle">4. Ghi ch√∫</h3>
<textarea class="textarea" name="nl_ghi_chu"></textarea>
<button class="button is-primary mt-4">üíæ L∆∞u nhi√™n li·ªáu</button>
</form>
</div>

<!-- ================== END TAG NHI√äN LI·ªÜU ================== -->

<!-- ================= TAG ƒê√ÅNH GI√Å NH√ÇN S·ª∞ ================= -->
<div id="danhgia" class="hidden form-box">
<button class="button mb-4" onclick="backHome()">‚¨Ö Quay l·∫°i</button>
<h2 class="title is-4">ƒê√ÅNH GI√Å NH√ÇN S·ª∞</h2>

<!-- TRA C·ª®U -->
<div class="box">
  <h3 class="subtitle">üîç Tra c·ª©u theo DG ID</h3>
  <div class="columns">
    <div class="column is-4">
      <input class="input" id="search_dg_id" placeholder="VD: DG001">
    </div>
    <div class="column">
      <button class="button is-info" onclick="searchdanhgia()">Tra c·ª©u</button>
    </div>
  </div>
</div>

<form id="danhgiaForm">

<h3 class="subtitle">1. Th√¥ng tin nh√¢n s·ª±</h3>
<div class="columns">
  <div class="column">
    <label class="label">DG ID</label>
    <input class="input" name="dg_id" required>
  </div>
  <div class="column">
    <label class="label">Ng√†y ƒë√°nh gi√°</label>
    <input class="input" type="date" name="dg_ngay">
  </div>
  <div class="column">
    <label class="label">M√£ nh√¢n vi√™n</label>
    <input class="input" name="dg_ma_nv">
  </div>
  <div class="column">
    <label class="label">H·ªç v√† t√™n</label>
    <input class="input" name="dg_ho_ten">
  </div>
</div>

<h3 class="subtitle">2. L·ªói vi ph·∫°m</h3>
<div class="columns">
  <div class="column">
    <label class="label">L·ªói vi ph·∫°m</label>
    <input class="input" name="dg_loi">
  </div>

 <div class="column">
  <div class="field">
    <label class="label">M·ª©c ƒë·ªô vi ph·∫°m</label>
    <div class="control">
      <div class="select is-fullwidth">
        <select name="dg_muc_do" required>
          <option value="">-- Ch·ªçn m·ª©c ƒë·ªô --</option>
          <option value="nhe">Nh·∫π - C·∫£nh b√°o</option>
          <option value="trung_binh">Trung b√¨nh - L·∫≠p bi√™n b·∫£n</option>
          <option value="nang">N·∫∑ng - K·ª∑ lu·∫≠t</option>
        </select>
      </div>
    </div>
  </div>
</div>


<h3 class="subtitle">3. Theo d√µi vi ph·∫°m</h3>
<div class="columns">
  <div class="column">
    <label class="label">S·ªë l·∫ßn vi ph·∫°m</label>
    <input class="input" type="number" name="dg_so_lan">
  </div>
  <div class="column">
    <label class="label">K·∫øt lu·∫≠n</label>
    <input class="input" name="dg_ket_luan">
  </div>
</div>

<h3 class="subtitle">4. Ghi ch√∫</h3>
<textarea class="textarea" name="dg_ghi_chu"></textarea>

<button class="button is-primary mt-4">üíæ L∆∞u ƒë√°nh gi√°</button>
</form>
</div>
<!-- ===== END TAG ƒê√ÅNH GI√Å ===== -->

<script>
/* ================= CONFIG ================= */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbykuNTd6d292UvwiJdXIryztAnKpBgoEzZbF7hAwnD_4X_E-HPeCyzQITocEyIiU8Sx/exec";

/* ================= UI NAV ================= */
function openTag(id){
  document.getElementById("home").classList.add("hidden");
  ["xe","taixe","nhatky","baoduong","fuel","danhgia"].forEach(t=>{
    document.getElementById(t)?.classList.add("hidden");
  });
  document.getElementById(id).classList.remove("hidden");
}

function backHome(){
  document.getElementById("home").classList.remove("hidden");
  ["xe","taixe","nhatky","baoduong","fuel","danhgia"].forEach(t=>{
    document.getElementById(t)?.classList.add("hidden");
  });
}

/* ================= SUBMIT FORM (FormData) ================= */
function submitForm(tag, form){
  const fd = new FormData(form);
  fd.append("tag", tag);

  fetch(SCRIPT_URL, {
    method: "POST",
    body: fd
  })
  .then(res => res.text())
  .then(txt => {
    console.log("SERVER:", txt);
    let r;
    try { r = JSON.parse(txt); } catch { r = {}; }

    if(r.status === "success"){
      alert("‚úÖ L∆∞u th√†nh c√¥ng");
      form.reset();
    }else{
      alert("‚ùå L·ªói l∆∞u d·ªØ li·ªáu");
    }
  })
  .catch(err=>{
    console.error(err);
    alert("‚ùå L·ªói k·∫øt n·ªëi server");
  });
}

/* ================= SEARCH ================= */
function searchByKey(tag, keyName, keyValue, formId){
  if(!keyValue){
    alert("‚ö†Ô∏è Thi·∫øu d·ªØ li·ªáu tra c·ª©u");
    return;
  }

  const url = `${SCRIPT_URL}?tag=${encodeURIComponent(tag)}&${encodeURIComponent(keyName)}=${encodeURIComponent(keyValue)}`;

  fetch(url)
    .then(res => res.json())
    .then(data=>{
      if(!data || Object.keys(data).length===0){
        alert("‚ùå Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu");
        return;
      }
      fillForm(formId, data);
    })
    .catch(err=>{
      console.error(err);
      alert("‚ùå L·ªói tra c·ª©u");
    });
}

/* ================= FORM UTIL ================= */
function fillForm(formId, data){
  const f = document.getElementById(formId);
  if(!f) return;

  Object.keys(data).forEach(k=>{
    if(!f.elements[k]) return;
    const el = f.elements[k];
    if(el.type === "checkbox") el.checked = data[k] === true || data[k] === "true";
    else if(el.type === "radio"){
      [...f.elements[k]].forEach(r=> r.checked = r.value === data[k]);
    }else{
      el.value = data[k];
    }
  });
}

/* ================= AUTO BIND SUBMIT ================= */
document.getElementById("xeForm")?.addEventListener("submit",e=>{
  e.preventDefault(); submitForm("xe", e.target);
});
document.getElementById("taixeForm")?.addEventListener("submit",e=>{
  e.preventDefault(); submitForm("taixe", e.target);
});
document.getElementById("nhatkyForm")?.addEventListener("submit",e=>{
  e.preventDefault(); submitForm("nhatky", e.target);
});
document.getElementById("baoduongForm")?.addEventListener("submit",e=>{
  e.preventDefault(); submitForm("baoduong", e.target);
});
document.getElementById("fuelForm")?.addEventListener("submit",e=>{
  e.preventDefault(); submitForm("fuel", e.target);
});
document.getElementById("danhgiaForm")?.addEventListener("submit",e=>{
  e.preventDefault(); submitForm("danhgia", e.target);
});

/* ================= SEARCH BUTTON ================= */
function searchXe(){
  searchByKey("xe","bien_so_xe",
    document.getElementById("search_bien_so_xe").value,
    "xeForm"
  );
}
function searchTaiXe(){
  searchByKey("taixe","ma_nv",
    document.getElementById("search_mnv").value,
    "taixeForm"
  );
}
function searchNhatKy(){
  searchByKey("nhatky","nk_id",
    document.getElementById("search_nk_id").value,
    "nhatkyForm"
  );
}
function searchbaoduong(){
  searchByKey("baoduong","bd_id",
    document.getElementById("search_bd_id").value,
    "baoduongForm"
  );
}
function searchfuel(){
  searchByKey("fuel","nl_id",
    document.getElementById("search_nl_id").value,
    "fuelForm"
  );
}
function searchdanhgia(){
  searchByKey("danhgia","dg_id",
    document.getElementById("search_dg_id").value,
    "danhgiaForm"
  );
}

/* ================= AUTO CALC ================= */
function calcNhatKy(){
  const f = document.getElementById("nhatkyForm");
  if(f.nk_gio_xuat.value && f.nk_gio_ve.value){
    const x = new Date("1970-01-01T"+f.nk_gio_xuat.value);
    const v = new Date("1970-01-01T"+f.nk_gio_ve.value);
    const diff = (v - x)/3600000;
    f.nk_tong_gio.value = diff > 0 ? diff.toFixed(2) : "";
  }
  const kmx = parseFloat(f.nk_km_xuat.value)||0;
  const kmv = parseFloat(f.nk_km_ve.value)||0;
  if(kmv > kmx) f.nk_tong_km.value = kmv - kmx;
}

function tinhTienNhienLieu(){
  const f = document.getElementById("fuelForm");
  const lit = parseFloat(f.nl_so_lit.value)||0;
  const gia = parseFloat(f.nl_don_gia.value)||0;
  f.nl_thanh_tien.value = lit && gia ? (lit*gia).toFixed(0) : "";
}
</script>

</body>
</html>




